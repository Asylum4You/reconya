{{define "components/device-list.html"}}
<!-- Search Input -->
<div class="mb-4">
    <div class="input-group">
        <span class="input-group-text bg-very-dark border-success text-success">
            <i class="bi bi-search"></i>
        </span>
        <input type="text" 
               class="form-control bg-very-dark border-success text-light" 
               id="deviceSearch" 
               placeholder="Search devices by IP, IPv6, name, MAC, vendor..."
               style="background-color: var(--bg-very-dark) !important; border-color: rgba(25, 135, 84, 0.3) !important; color: #e9ecef !important;">
    </div>
</div>

<div class="table-responsive">
    <table class="table table-dark table-sm" id="devicesTable">
        <thead>
            <tr>
                <th>IP Address</th>
                <th>IPv6 Address</th>
                <th>Name</th>
                <th>MAC Address</th>
                <th>Vendor</th>
                <th>OS</th>
                <th>Status</th>
                <th>Ports</th>
                <th>Last Seen</th>
            </tr>
        </thead>
        <tbody>
            {{range .Devices}}
            <tr hx-get="/api/devices/{{.ID}}/modal" hx-target="#device-modal-content" hx-trigger="click" style="cursor: pointer;">
                <td>{{.IPv4}}</td>
                <td>
                    {{if .IPv6Global}}
                        <span class="text-info" title="Global IPv6">{{.IPv6Global}}</span>
                    {{else if .IPv6UniqueLocal}}
                        <span class="text-warning" title="Unique Local IPv6">{{.IPv6UniqueLocal}}</span>
                    {{else if .IPv6LinkLocal}}
                        <span class="text-secondary" title="Link Local IPv6">{{.IPv6LinkLocal}}</span>
                    {{else}}
                        <span class="text-muted">-</span>
                    {{end}}
                </td>
                <td>{{or .Name (deref .Hostname) "-"}}</td>
                <td>{{deref .MAC}}</td>
                <td>{{deref .Vendor}}</td>
                <td>
                    {{if .OS}}
                        {{if contains .OS.Name "Windows"}}<i class="bi bi-windows" title="{{.OS.Name}}"></i>{{else if contains .OS.Name "Linux"}}<i class="bi bi-ubuntu" title="{{.OS.Name}}"></i>{{else if contains .OS.Name "macOS"}}<i class="bi bi-apple" title="{{.OS.Name}}"></i>{{else if contains .OS.Name "Android"}}<i class="bi bi-android2" title="{{.OS.Name}}"></i>{{else if contains .OS.Name "iOS"}}<i class="bi bi-phone" title="{{.OS.Name}}"></i>{{else}}<i class="bi bi-device-hdd" title="{{.OS.Name}}"></i>{{end}}
                    {{else}}
                        <i class="bi bi-question-circle text-muted" title="Unknown OS"></i>
                    {{end}}
                </td>
                <td class="status-{{string .Status}}">
                    {{.Status}}
                </td>
                <td>
                    {{$filtered := 0}}{{$open := 0}}
                    {{range .Ports}}
                        {{if eq .State "filtered"}}{{$filtered = add $filtered 1}}{{end}}
                        {{if eq .State "open"}}{{$open = add $open 1}}{{end}}
                    {{end}}
                    {{if and (gt $filtered 0) (gt $open 0)}}
                        <span class="text-warning">{{$filtered}}</span> / <span class="text-danger">{{$open}}</span>
                    {{else if gt $filtered 0}}
                        <span class="text-warning">{{$filtered}}</span>
                    {{else if gt $open 0}}
                        <span class="text-danger">{{$open}}</span>
                    {{else}}
                        <span class="text-muted">-</span>
                    {{end}}
                </td>
                <td>{{formatTimeAgo .LastSeenOnlineAt}}</td>
            </tr>
            {{else}}
            <tr>
                <td colspan="9" class="text-center text-muted">No devices found.</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>

<script>
// Setup search functionality immediately when this content loads
setTimeout(function() {
    const searchInput = document.getElementById('deviceSearch');
    const table = document.getElementById('devicesTable');
    
    if (searchInput && table) {
        // Remove any existing event listeners
        searchInput.replaceWith(searchInput.cloneNode(true));
        const newSearchInput = document.getElementById('deviceSearch');
        
        newSearchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = table.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
        
        console.log('Device search functionality initialized');
    } else {
        console.log('Search input or table not found');
    }
}, 100);
</script>

<style>
/* Custom hover effect with green border instead of gray background */
#devicesTable {
    border-collapse: separate;
    border-spacing: 0 2px;
}

#devicesTable tbody tr {
    border: 1px solid transparent;
}

#devicesTable tbody tr:hover {
    background-color: transparent !important;
    border: 2px solid rgba(25, 135, 84, 0.8) !important;
    cursor: pointer;
    position: relative;
    z-index: 10;
    outline: 1px solid rgba(25, 135, 84, 0.8);
    outline-offset: -1px;
}

#devicesTable tbody tr:hover td {
    background-color: transparent !important;
}
</style>
{{end}}