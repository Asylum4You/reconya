{{define "components/network-list.html"}}
<!-- Add Network Button -->
<div class="mb-4 d-flex justify-content-between align-items-center">
    <div>
        <p class="text-muted mb-0">Manage network ranges for reconnaissance scanning</p>
    </div>
    <button class="btn btn-success" 
            onclick="showNetworkModal('/api/network-modal')">
        <i class="bi bi-plus-circle me-2"></i>Add New Network
    </button>
</div>

<!-- Networks Table -->
<div class="table-responsive">
    <table class="table table-dark table-sm networks-table">
        <thead>
            <tr>
                <th>Network</th>
                <th>CIDR</th>
                <th>Status</th>
                <th>Devices</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {{range .Networks}}
            <tr class="network-row {{if and $.ScanState.SelectedNetwork (eq .ID $.ScanState.SelectedNetwork.ID)}}selected-network{{end}}"
                hx-post="/api/scan/select-network"
                hx-vals='{"network-id": "{{.ID}}"}'
                hx-trigger="click"
                hx-swap="none"
                data-network-id="{{.ID}}">
                <td>{{or .Name "Unnamed Network"}}</td>
                <td><code class="text-success">{{.CIDR}}</code></td>
                <td>
                    {{if eq .Status "active"}}
                        <span class="badge bg-success">Active</span>
                    {{else if eq .Status "scanning"}}
                        <span class="badge bg-warning">Scanning</span>
                    {{else}}
                        <span class="badge bg-secondary">Inactive</span>
                    {{end}}
                </td>
                <td>{{.DeviceCount}} devices</td>
                <td>
                    <button class="btn btn-sm btn-outline-success me-1" 
                            onclick="event.stopPropagation(); showNetworkModal('/api/network-modal/{{.ID}}')"
                            title="Edit">
                        <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" 
                            onclick="event.stopPropagation(); showNetworkDeleteModal('{{.ID}}')"
                            title="Delete">
                        <i class="bi bi-trash"></i>
                    </button>
                </td>
            </tr>
            {{else}}
            <tr>
                <td colspan="5" class="text-center text-muted py-4">
                    <i class="bi bi-diagram-3 me-2"></i>
                    No networks configured. Add your first network to start scanning.
                </td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>


<style>
.networks-table tbody tr {
    cursor: pointer;
    transition: all 0.2s ease;
}

.networks-table tbody tr:hover {
    background-color: rgba(25, 135, 84, 0.1) !important;
}

.networks-table .selected-network {
    background-color: rgba(25, 135, 84, 0.2) !important;
    border-left: 4px solid var(--bs-success);
}

.networks-table code {
    background-color: rgba(25, 135, 84, 0.1);
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 0.85em;
}
</style>

<script>
// Debug: Check what's available
console.log('Network list component loaded. Global functions available:', {
    showNetworkDeleteModal: typeof window.showNetworkDeleteModal,
    showNetworkModal: typeof window.showNetworkModal
});

// Ensure functions are always available on window object
window.showNetworkDeleteModal = function(networkId) {
    console.log('Network delete modal called for:', networkId);
    
    // Check if modal container exists
    const modalContainer = document.getElementById('networkDeleteModal');
    if (!modalContainer) {
        console.error('networkDeleteModal container not found!');
        alert('Modal container not available. Please refresh the page.');
        return;
    }
    
    // Load the modal content
    htmx.ajax('GET', `/api/network-delete-modal/${networkId}`, { 
        target: '#network-delete-modal-content' 
    });
};

window.showNetworkModal = function(url) {
    console.log('Network modal called for:', url);
    
    // Check if modal container exists  
    const modalContainer = document.getElementById('networkModal');
    if (!modalContainer) {
        console.error('networkModal container not found!');
        alert('Modal container not available. Please refresh the page.');
        return;
    }
    
    // Load the modal content
    htmx.ajax('GET', url, { target: '#network-modal-content' });
};

// Ensure modal event handlers are available (avoid duplicate listeners)
if (!window.networkModalHandlersAttached) {
    document.addEventListener('htmx:afterRequest', function(event) {
        if (event.detail.target.id === 'network-delete-modal-content') {
            const modalEl = document.getElementById('networkDeleteModal');
            if (modalEl) {
                const modal = new bootstrap.Modal(modalEl);
                modal.show();
            } else {
                console.error('networkDeleteModal element not found when trying to show modal');
            }
        }
        
        if (event.detail.target.id === 'network-modal-content') {
            const modalEl = document.getElementById('networkModal');
            if (modalEl) {
                const modal = new bootstrap.Modal(modalEl);
                modal.show();
            } else {
                console.error('networkModal element not found when trying to show modal');
            }
        }
    });
    
    window.networkModalHandlersAttached = true;
    console.log('Network modal event handlers attached');
}
</script>
{{end}}